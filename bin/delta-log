#! /usr/bin/perl -w

use POSIX qw(strftime);
use Time::Local;
my $format = "%12.06f";

my $previous_time;

while (<>) {
    if (/\b(\d{4})-(\d{2})-(\d{2}).(\d{2}):(\d{2}):(\d{2})\.(\d+)/) {
        my $subsec = $7 / 10**(length $7);
        my $t = timelocal($6, $5, $4, $3, $2-1, $1-1900) + $subsec;
        my $delta = defined $previous_time ? $t - $previous_time : 0.0;
        $previous_time = $t;
        s/\b(\d{4})-(\d{2})-(\d{2}).(\d{2}):(\d{2}):(\d{2})\.(\d+)/sprintf($format, $delta)/e;
    }
    print;
}
